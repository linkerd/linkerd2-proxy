---
dist: trusty
sudo: false

# We do not test pushes to branches, since they are redundant with the
# pull_request build for each branch.
branches:
  only:
    - master

stages:
  - fetch
  - build
  - test

jobs:
  include:
    - stage: fetch
      language: rust
      rust: stable
      cache: cargo
      script: cargo fetch --locked --no-default-features

    - stage: build
      language: rust
      rust: stable
      cache: cargo
      script: cargo build --release --frozen --no-default-features --verbose

    - stage: test
      language: rust
      rust: stable
      cache: cargo
      script: cargo test --release --frozen --no-default-features

    - rust: nightly-2018-05-26
      language: rust
      cache: cargo
      script: cargo test --benches --frozen --no-default-features

notifications:
  email:
    on_success: never
